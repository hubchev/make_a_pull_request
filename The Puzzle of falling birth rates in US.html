<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Venkatesh Kannan">
<meta name="author" content="Email: kannan.venkatesh@stud.hs-fresenius.de">
<meta name="author" content="ID: 400370901">
<meta name="dcterms.date" content="2025-02-02">

<title>The Puzzle of Falling Birthrates in USA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="The Puzzle of falling birth rates in US_files/libs/clipboard/clipboard.min.js"></script>
<script src="The Puzzle of falling birth rates in US_files/libs/quarto-html/quarto.js"></script>
<script src="The Puzzle of falling birth rates in US_files/libs/quarto-html/popper.min.js"></script>
<script src="The Puzzle of falling birth rates in US_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="The Puzzle of falling birth rates in US_files/libs/quarto-html/anchor.min.js"></script>
<link href="The Puzzle of falling birth rates in US_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="The Puzzle of falling birth rates in US_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="The Puzzle of falling birth rates in US_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="The Puzzle of falling birth rates in US_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="The Puzzle of falling birth rates in US_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Puzzle of Falling Birthrates in USA</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Venkatesh Kannan </p>
             <p>Email: kannan.venkatesh@stud.hs-fresenius.de </p>
             <p>ID: 400370901 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>In this analysis, I work on the extreme decline in US birth rates since the Great Recession using <span class="citation" data-cites="10.1257/jep.36.1.151">(<a href="#ref-10.1257/jep.36.1.151" role="doc-biblioref">Kearney et al., 2022</a>)</span> for a guide. I intend to reproduce and extend empirical results of the original paper with an aim of deeper understanding of diversified factors driving birth rates. With R Studio being the main instrument, I dwell on the interrelationship of economic, social, and policy influences that have led to the sustained decline in fertility rates. This report is written in R Markdown, which provides a full integration of analysis and documentation; presentation developed in Quarto effectively communicates the findings. Throughout the whole work, Git and GitHub functions will be very useful in replicating and managing the workflow, structuring the handling of updates and revisions that will be necessary. This replication not only serves to validate the robustness of the initial results but deepens my insight into how economic conditions and societal shifts are framing reproductive decisions. The complexity of my findings is indicative that many factors intermingled beyond simple economic ones are at play, shaping reproductive choices in the United States.</p>
</section>
<section id="introduction" class="level1">
<h1>1 Introduction</h1>
<p>The United States experienced a dramatic decline in birth rates since 2007, not only during the Great Recession but well into the subsequent recovery and beyond.<span class="citation" data-cites="10.1257/jep.36.1.151">(<a href="#ref-10.1257/jep.36.1.151" role="doc-biblioref">Kearney et al., 2022</a>)</span> proceed with an inquiry into this idea, taking each of various possible economic, social, and policy reasons that can influence fertility decisions. Their work has emphasized the ways in which changing economic fortunes, evolving social norms, and shifting policy climates may play into emerging patterns of fertility.</p>
<p>This decline in birth rates is multi-factorial and complex in nature, impacting the demographic pattern of the country along with economic and social systems. Understanding what accounts for such a change is imperative for policy analysts, healthcare managers, and social scientists, given that long-range planning demands anticipating future changes and their effects on demographic structures. As birth rates continue shaping up economic outcomes and configurations of society, the analyses of such trends become ever so important.</p>
<p>Data for this project was acquired with from the repository linked to <span class="citation" data-cites="10.1257/jep.36.1.151">(<a href="#ref-10.1257/jep.36.1.151" role="doc-biblioref">Kearney et al., 2022</a>)</span>, available at <a href="https://www.aeaweb.org/articles?id=10.1257/jep.36.1.151">https://www.aeaweb.org/articles?id=10.1257/jep.36.1.151</a> This.zip file contains all the ‘.dta’ files, which are the data files for Stata, a statistical software tool, and all the ‘.do’ files, which are the script files containing commands that Stata executes and ‘.csv’ file that can be analysed in Excel file. The raw data needed for analysis, as well as all variables on birth rates, demographic factors, and socioeconomic indicators across different states and time periods, are contained in the ‘.dta’ files. All the code necessary to replicate the analyses of the original paper can be found in the ‘.do’ files, allowing for an accurate reconstruction of the findings of the study.</p>
</section>
<section id="objective" class="level1">
<h1>2 Objective</h1>
<p>The aim of the project is to reproduce and extend the analysis of <span class="citation" data-cites="10.1257/jep.36.1.151">(<a href="#ref-10.1257/jep.36.1.151" role="doc-biblioref">Kearney et al., 2022</a>)</span> about the decline in birth rates since the Great Recession in the United States. This project will be specifically devoted to reproducing some of the key graphical displays of the original paper: time series of the total birth rate, state-by-state decline in birth rates, time series of birth rates by age group, and racial composition. It also tends to display the reproduction rates of different cohorts of mothers throughout their lifetime.</p>
</section>
<section id="methodology" class="level1">
<h1>3 Methodology</h1>
<p>The review of R and R Markdown at the outset of the methodology ensures robustness in analysis. Further, this study discusses the collection of data from the ‘.dta’ and ‘.do’ files availed from the repository of the American Economic Association. The next section elaborates on a replication strategy aimed at reconstructing the original findings in <span class="citation" data-cites="10.1257/jep.36.1.151">(<a href="#ref-10.1257/jep.36.1.151" role="doc-biblioref">Kearney et al., 2022</a>)</span>, with extensions aimed at enhancing comprehension of the dynamic nature of U.S. birth rates</p>
<section id="r" class="level2">
<h2 class="anchored" data-anchor-id="r">3.1 R</h2>
<p>R is basically designed for statistical computing and plotting. Ross Ihaka and Robert Gentleman from Auckland univeristy, New Zealand, initiated the R programming language in the early 1990s. Since then R has matured into a comprehensive platform that is integrated with several packages and libraries. RStudio is one such distribution based on it. Among the goals for the language designers is to make syntax easy to use and powerful especially for tasks that pertain to data manipulation and Statistical calculations. This structure also facilitates the persons who enter into the field of data analysis and replication to easily work with the system.</p>
</section>
<section id="r-markdown" class="level2">
<h2 class="anchored" data-anchor-id="r-markdown">3.2 R Markdown</h2>
<p>R Markdown is a generic documentation tool that allows R users to produce high-quality dynamic reports and presentations. It allows one to embed narrative text, code, and its output in one document, rendering into various formats: HTML, PDF, Word. It thus gracefully meets analysis and reporting. This tool is crucial for all researchers and analysts who want to share their findings in a comprehensive and reproducible way: it keeps data analysis and its textual description tightly coupled and easily accessible.</p>
</section>
<section id="data-collection" class="level2">
<h2 class="anchored" data-anchor-id="data-collection">3.3 Data Collection</h2>
<p>This is a replication study for which data is downloaded from the American Economic Association web portal <a href="https://www.aeaweb.org/articles?id=10.1257/jep.36.1.151">https://www.aeaweb.org/articles?id=10.1257/jep.36.1.151</a>. In the given data with this replication package, there is a number of ‘.dta’ and ‘.do’ files included. They contain a complete set of data such as state-year-level aggregate birth data, birth rates by mother’s education level,birth order, and total population retrieved from multiple reliable sources. The data underlying the statistical analysis are stored in the ‘.dta’ files, and the ‘.do’ files store Stata commands used to process and analyze data in a thorough, structured way in order to reproduce the original study’s analyses or extend them wherever possible.</p>
<p>Data File: The replication package contains several datasets, most relevant for the analysis of trends and determinants of birth rates in the United States. In detail, the list of the included datasets is the following: 1.data/nchs/nchs_1990_2020.dta 2.data/nchs/nchs_cohort_analysis.dta<br>
3.data/pop/us.1990_2019.singleages.dta 4.data/sec_2a/hisp_nativity.dta 5.data/annual_policy/policyvars01_19.dta 6.data/decomp/cps_19902019.dta 7.data/decomp/state_year_age6grp_educ_raceeth_pop1544_aggteens.dt 8.data/long_term/longdiff-RHS-0408 9.data/long_term/longdiff-RHS-1519</p>
</section>
<section id="process-of-replication" class="level2">
<h2 class="anchored" data-anchor-id="process-of-replication">3.4 Process Of Replication</h2>
<p>I started the replication process by opening the working paper on the official webpage of the American Economic Association. After obtaining this information, I downloaded the working paper and the complete replication package. In the replication package, there is a Zip file named 144981-V1, containing few ‘.dta’ files, which is a Stata file format used to conduct the analysis, and ‘.do’file which is the code or directions to be followed for replicating the figures in the <span class="citation" data-cites="10.1257/jep.36.1.151">(<a href="#ref-10.1257/jep.36.1.151" role="doc-biblioref">Kearney et al., 2022</a>)</span> paper. The replication package contains a readme file just to inform about the data set and provide links to download them. The analysis in’.dta’ format was done through R studios.</p>
<p>The research provided a systematic approach toward the generation of initial replication graphs. From Figure 1, the data taken from “nchs_births_pop_1990_2019.dta”. Libraries for “ggplot” in “tidyverse” were used for data transformation, first by installing using install.packages(“ggplot2”) and install.packages(“tidyverse”). Following that, I now import their functions into R studios using library(ggplot) and library(tidyverse), as well as other functions such as “tidyr” for manipulating data. “sf” for spatial data and most importantly “haven” for reading ‘.dta’ files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)          <span class="co"># For spatial data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)       <span class="co"># For data manipulation (pivot_wider)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)       <span class="co"># For .dta files</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set output file path</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/Venka/Desktop/Uni subjects/Data science in business/The Puzzle of Falling Birthrates in The USA"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>output_path <span class="ot">&lt;-</span> <span class="st">"C:/Users/Venka/Desktop/Uni subjects/Data science in business/144981-V1 (2)/output/fig_1.png"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I set the working directory path and output file path based on the instruction given in the fig1.do file. I imported the ‘.dta’ file “nchs_births_pop_1990_2019.dta” to visualise the total trend in Total Births in the USA using the following code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>birth_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"nchs_births_pop_1990_2019.dta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="graphical-representation" class="level1">
<h1>4 Graphical Representation</h1>
<section id="trend-in-total-births" class="level2">
<h2 class="anchored" data-anchor-id="trend-in-total-births">4.1 Trend in Total Births</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace missing values with zero</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>birth_data[<span class="fu">is.na</span>(birth_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total births per year</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>birth_yearly <span class="ot">&lt;-</span> birth_data <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_births =</span> <span class="fu">sum</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"numbirth_"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the trend in total births with a vertical line at 2007</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>fig_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(birth_yearly, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_births)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2007</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trend in Total Births (1990-2019)"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Births"</span>) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot as a PNG file</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(output_path, <span class="at">plot =</span> fig_1, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the graph</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fig_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="The-Puzzle-of-falling-birth-rates-in-US_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this R script, I first loaded a dataset from a Stata file called <code>nchs_births_pop_1990_2019.dta</code> containing detailed information on U.S. births between 1990 and 2019. Any inconsistencies in the data set were fixed by replacing the missing values with zeros for a smooth process in handling data downstream. Next, I used the <code>group_by</code> in the <code>dplyr</code> package to get the total birth per year; this was by summing the columns that start with “numbirth_” in each group and ignoring residual missing values so that the summation would not get affected.</p>
<p>I have used the <code>ggplot2</code> package to visualize it, creating a detailed line plot of the total number of births for each year. I charted and labeled all data points to enhance readability. To identify a notable year within the data set, I applied a red dashed vertical line at the year 2007. This is a visual marker that flags a potential inflection point or notable event driving birth trends. I then saved the resultant plot in a high-resolution PNG format to a specified directory and displayed the plot on-screen, allowing both the preservation and immediate review of the visual data analysis. This will ensure that birth trends over the period specified would be clearly and effectively presented, especially those that have captured the important moments in history.</p>
</section>
<section id="decline-in-birth-rates-by-state" class="level2">
<h2 class="anchored" data-anchor-id="decline-in-birth-rates-by-state">4.2 Decline in Birth Rates by State</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_use_cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set File Paths</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/Venka/Desktop/Uni subjects/Data science in business/The Puzzle of Falling Birthrates in The USA"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>output_path <span class="ot">&lt;-</span> <span class="st">"C:/Users/Venka/Desktop/Uni subjects/Data science in business/144981-V1 (2)/output/fig_3.png"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>output_csv_path <span class="ot">&lt;-</span> <span class="st">"C:/Users/Venka/Desktop/Uni subjects/Data science in business/144981-V1 (2)/output/fig_3.csv"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"age_race_comp_seer.dta"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>pop_data_processed <span class="ot">&lt;-</span> pop_data <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop1544 =</span> pop1519 <span class="sc">+</span> pop2034 <span class="sc">+</span> pop3544,  <span class="co"># Summing population age groups</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">stname =</span> <span class="fu">toupper</span>(<span class="fu">trimws</span>(stname))  <span class="co"># Normalize state names</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((year <span class="sc">&gt;=</span> <span class="dv">2004</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2008</span>) <span class="sc">|</span> (year <span class="sc">&gt;=</span> <span class="dv">2015</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2019</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year2 =</span> <span class="fu">ifelse</span>(year <span class="sc">&lt;=</span> <span class="dv">2008</span>, <span class="dv">2004</span>, <span class="dv">2019</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Collapse years</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stname, year2) <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop1544 =</span> <span class="fu">sum</span>(pop1544, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Process birth data</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>birth_data_processed <span class="ot">&lt;-</span> birth_data <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stname =</span> <span class="fu">toupper</span>(<span class="fu">trimws</span>(stname))) <span class="sc">%&gt;%</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((year <span class="sc">&gt;=</span> <span class="dv">2004</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2008</span>) <span class="sc">|</span> (year <span class="sc">&gt;=</span> <span class="dv">2015</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2019</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year2 =</span> <span class="fu">ifelse</span>(year <span class="sc">&lt;=</span> <span class="dv">2008</span>, <span class="dv">2004</span>, <span class="dv">2019</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Collapse years</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stname, year2) <span class="sc">%&gt;%</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">numbirth1544 =</span> <span class="fu">sum</span>(numbirth1544, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge birth &amp; population data</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(birth_data_processed, pop_data_processed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"stname"</span>, <span class="st">"year2"</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot years into separate columns for proper calculations</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> year2, </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(numbirth1544, pop1544),</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"year_"</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute birth rates and changes</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate_2004 =</span> (numbirth1544_year_2004 <span class="sc">/</span> pop1544_year_2004) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate_2019 =</span> (numbirth1544_year_2019 <span class="sc">/</span> pop1544_year_2019) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate1544_thsnds_ch =</span> brate_2019 <span class="sc">-</span> brate_2004,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate1544_thsnds_ch_pct =</span> <span class="dv">100</span> <span class="sc">*</span> (brate_2019 <span class="sc">-</span> brate_2004) <span class="sc">/</span> brate_2004</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Load U.S. state shapes using `tigris::states()`</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">states</span>(<span class="at">cb =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">stname =</span> <span class="fu">toupper</span>(NAME),  <span class="co"># Normalize state names</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_abbr =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>      NAME <span class="sc">==</span> <span class="st">"American Samoa"</span> <span class="sc">~</span> <span class="st">"AS"</span>,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>      NAME <span class="sc">==</span> <span class="st">"Guam"</span> <span class="sc">~</span> <span class="st">"GU"</span>,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>      NAME <span class="sc">==</span> <span class="st">"District of Columbia"</span> <span class="sc">~</span> <span class="st">"DC"</span>,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>      NAME <span class="sc">==</span> <span class="st">"Commonwealth of the Northern Mariana Islands"</span> <span class="sc">~</span> <span class="st">"MP"</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>      NAME <span class="sc">==</span> <span class="st">"United States Virgin Islands"</span> <span class="sc">~</span> <span class="st">"VI"</span>,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>      NAME <span class="sc">==</span> <span class="st">"Puerto Rico"</span> <span class="sc">~</span> <span class="st">"PR"</span>,</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> state.abb[<span class="fu">match</span>(NAME, state.name)]  <span class="co"># Use state.abb for other states</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for remaining missing abbreviations</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(us_states<span class="sc">$</span>state_abbr))) {</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Some state names still do not have corresponding abbreviations:"</span>)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(us_states <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(state_abbr)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(NAME))</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Debug: Check unmatched rows</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State names in wide_data:"</span>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(wide_data<span class="sc">$</span>stname))</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State names in us_states:"</span>)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(us_states<span class="sc">$</span>stname))</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>unmatched_states <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(wide_data, us_states, <span class="at">by =</span> <span class="st">"stname"</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unmatched states:"</span>)</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unmatched_states)</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Load U.S. state shapes using `tigris::states()`</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">states</span>(<span class="at">cb =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>NAME <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">"American Samoa"</span>, </span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Guam"</span>, </span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Commonwealth of the Northern Mariana Islands"</span>, </span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"United States Virgin Islands"</span>, </span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Puerto Rico"</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">stname =</span> <span class="fu">toupper</span>(NAME),  <span class="co"># Normalize state names</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_abbr =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>      NAME <span class="sc">==</span> <span class="st">"Hawaii"</span> <span class="sc">~</span> <span class="st">"HI"</span>,  <span class="co"># Include Hawaii</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> state.abb[<span class="fu">match</span>(NAME, state.name)]  <span class="co"># Use state.abb for other states</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge state shapes with birth rate changes</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">left_join</span>(us_states, wide_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state_abbr"</span> <span class="ot">=</span> <span class="st">"stname"</span>))</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix missing values in percentage change</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>us_states<span class="sc">$</span>brate1544_thsnds_ch_pct <span class="ot">&lt;-</span> <span class="fu">replace_na</span>(us_states<span class="sc">$</span>brate1544_thsnds_ch_pct, <span class="dv">0</span>)</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Define bins and colors for percentage change</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#d73027"</span>, <span class="st">"#fc8d59"</span>, <span class="st">"#fee08b"</span>, <span class="st">"#91bfdb"</span>)  <span class="co"># Red to blue gradient</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="cn">Inf</span>)                      <span class="co"># Define bins</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"&lt; -10%"</span>, <span class="st">"-10% to -5%"</span>, <span class="st">"-5% to 0%"</span>, <span class="st">"&gt; 0%"</span>)  <span class="co"># Bin labels</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the map with longitude range</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>fig_3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(us_states) <span class="sc">+</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">cut</span>(brate1544_thsnds_ch_pct, <span class="at">breaks =</span> breaks, <span class="at">labels =</span> labels)), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">setNames</span>(colors, labels), <span class="at">name =</span> <span class="st">"Birth Rate Change (%)"</span>) <span class="sc">+</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">160</span>,<span class="sc">-</span><span class="dv">50</span>)) <span class="sc">+</span>  </span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change in Average Birth Rates by State (2004-2008 to 2015-2019)"</span>,</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Birth rates per 1,000 women aged 15-44"</span>,</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Notes: Birth Rates are calculated among women aged 15-44. Source: NCHS Vital Statistics &amp; CDC SEER Population Data"</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot with larger dimensions and Hawaii included</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(output_path, <span class="at">plot =</span> fig_3, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fig_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="The-Puzzle-of-falling-birth-rates-in-US_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the R code, I used two very crucial data sets to achieve an in-depth analysis of births across the U.S. through selected periods of time. The first data set taken from the “age_race_comp_seer.dta” includes demographic information-precise by age population at various states’ levels in a number of consequent years in the United States. This is crucial data in building an understanding of the population base that the birth rate will be calculated on and narrows the focus down to women between ages 15-44. Cleaning this data was done by aggregating populations by relevant age group and standardizing state names in all uppercase; this ensures accurate merges during later steps.</p>
<p>To complement the demographic data, the second important data used is from “nchs_births_pop_1990_2019.dta,” which shows birth numbers across states and years. This birth dataset required similar preprocessing steps to perfectly align with the demographic data, focusing on the same age demographic and making sure state names were standardized across both datasets. This would ensure that the data sets align on key variables such as state names and year ranges for analysis, ensuring birth data perfectly matches demographic data for calculations.</p>
<p>Both of these data sets preprocessed and aligned, I merged them using a left join operation from ‘state name’ and a new variable ‘year2’. This variable ‘year2’ divided the time in two groups, 2004-2008 and 2015-2019, to clearly separate the birth rates before and after that period. This was an important merge that joined the detailed birth numbers with corresponding population figures, thus enabling the exact calculation of birth rates per 1,000 women in the specified age bracket.</p>
<p>After merging, the combined dataset allowed computation of birth rates for each state and period, followed by calculation of changes in these rates across the years. These were then visualized to show graphically the change in birth rates across different states in the U.S. from one period to the next. The reason for this was to ensure that rigorous preparation, alignment, and merging of both demographic and birth datasets would provide valid and insightful analyses into trends of birth rates, highlighting regional differences and temporal changes effectively.</p>
</section>
<section id="lifetime-fertility-by-mothers-birth-cohorts" class="level2">
<h2 class="anchored" data-anchor-id="lifetime-fertility-by-mothers-birth-cohorts">4.3 Lifetime Fertility by Mothers Birth Cohorts</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nchs_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"nchs_cohort_analysis.dta"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>seer_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"agecomp-seer.dta"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>seer_data <span class="ot">&lt;-</span> seer_data <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"fem15"</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"fem20"</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"fem35"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"fem"</span>), <span class="at">names_to =</span> <span class="st">"mage"</span>, <span class="at">values_to =</span> <span class="st">"pop"</span>, <span class="at">names_prefix =</span> <span class="st">"fem"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mage =</span> <span class="fu">as.numeric</span>(mage),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(year),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort =</span> year <span class="sc">-</span> mage,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort2 =</span> <span class="fu">cut</span>(cohort, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1967</span>, <span class="dv">1972</span>, <span class="dv">1977</span>, <span class="dv">1982</span>, <span class="dv">1987</span>, <span class="dv">1992</span>, <span class="dv">1997</span>), <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort2 =</span> <span class="fu">as.character</span>(cohort2)) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort2, mage) <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pop =</span> <span class="fu">sum</span>(pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>nchs_data <span class="ot">&lt;-</span> nchs_data <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">mage =</span> <span class="fu">as.numeric</span>(mage),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort2 =</span> <span class="fu">as.character</span>(cohort2)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(nchs_data<span class="sc">$</span>mage))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(seer_data<span class="sc">$</span>mage))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(nchs_data<span class="sc">$</span>cohort2))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(seer_data<span class="sc">$</span>cohort2))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>nchs_data_adjusted <span class="ot">&lt;-</span> nchs_data <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mage <span class="sc">%in%</span> <span class="fu">unique</span>(seer_data<span class="sc">$</span>mage))</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>seer_data <span class="ot">&lt;-</span> seer_data <span class="sc">%&gt;%</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cohort2))  <span class="co"># Exclude rows where cohort2 is NA</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(nchs_data_adjusted, seer_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"mage"</span>, <span class="st">"cohort2"</span>))</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(matched_data<span class="sc">$</span>pop)))</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(matched_data<span class="sc">$</span>numbirth)))</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> matched_data <span class="sc">%&gt;%</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort2) <span class="sc">%&gt;%</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mage) <span class="sc">%&gt;%</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate =</span> (numbirth <span class="sc">/</span> pop) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_brate =</span> <span class="fu">cumsum</span>(brate)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(matched_data, <span class="fu">aes</span>(<span class="at">x =</span> mage, <span class="at">y =</span> cum_brate, <span class="at">group =</span> cohort2, <span class="at">color =</span> cohort2)) <span class="sc">+</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>, <span class="st">"#2ca02c"</span>, <span class="st">"#d62728"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#8c564b"</span>),  <span class="co"># Custom colors for each cohort</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1968-72"</span>, <span class="st">"1973-77"</span>, <span class="st">"1978-82"</span>, <span class="st">"1983-87"</span>, <span class="st">"1988-92"</span>, <span class="st">"1993-97"</span>)  <span class="co"># Custom labels for each cohort</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Lifetime Fertility, by Mother's Birth Cohort: US"</span>,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Mother's Age"</span>,</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative Births per Woman"</span>,</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Birth Cohort"</span>  <span class="co"># Label for the color legend</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="The-Puzzle-of-falling-birth-rates-in-US_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"lifetime_fertility_plot.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this R script, I will be working with two different datasets: <code>nchs_cohort_analysis.dta</code> and <code>agecomp-seer.dta</code>, which I have loaded and named <code>nchs_data</code> and <code>seer_data</code>, respectively. First, I cleaned up <code>seer_data</code> by removing columns that had specific prefixes corresponding to age groups irrelevant to my analysis. Then I transformed this dataset into a long-format dataset, where each row represented the population count of a particular age using the <code>pivot_longer</code> function. During this transformation, I also calculated each individual’s birth cohort by subtracting their age from the recorded year, further grouping these into labeled cohort bins.</p>
<p>First, I standardized age and cohort labels in both the data sets for completeness and to effectively merge them correctly. Following the standardization of the aforementioned variables, I filtered nchs_data for only those ages which exist within seer_data, making both data sets compatible with each other and I excluded the rows where the cohort was missing in the case of <code>seer_data</code> to keep data integrity. Next, a full join would combine the cleaned <code>nchs_data</code> and <code>seer_data</code> based on age and cohort group for one data set called <code>matched_data</code>. This will associate the numbers of births to the population across cohorts.</p>
<p>Then, I also checked the missing values in the key columns after merging to ascertain that further analysis would not be compromised. Now, birth rates per 1,000 women were calculated from the merged data grouped by cohorts and ordered in maternal age and corresponding cumulative birth rates. Indeed, these played an important part in the different generations’ analyses of fertility trends.</p>
<p>Finally, I visualized these trends using a line plot via <code>ggplot2</code>, assigning unique colors and labels to each cohort group for clear differentiation. This plot presents the cumulative birth rates as a function of mother’s age, divided into birth cohorts. I saved this plot to a PNG file, ensuring it was saved for presentation and further analysis.</p>
<p>This holistic approach allowed me to analyze and visualize longitudinal fertility trends by maternal age cohort effectively, underlining generational changes in fertility behaviors within the U.S. population.</p>
</section>
</section>
<section id="various-facets-of-the-process-of-replication" class="level1">
<h1>5Various Facets of the process of Replication</h1>
<section id="tools-used" class="level2">
<h2 class="anchored" data-anchor-id="tools-used">5.1 Tools Used</h2>
<p>5.1 Tool Used The study mainly depended on the lecture notes provided by Prof.&nbsp;Dr.&nbsp;Stephan Huber, which can be accessed at <a href="https://hubchev.github.io/ds/">https://hubchev.github.io/ds/</a>.Additional tools were used for this job were. 1. R Studio: it served as the main interface for coding in R-script and preparing the report using R-Markdown. 2. Online tools : Several internet-based tools such as Chatgpt and bard Use Google’s AI for better coding and to visualize things nicely.</p>
</section>
<section id="issues-faced" class="level2">
<h2 class="anchored" data-anchor-id="issues-faced">5.2 Issues Faced</h2>
<section id="r-language" class="level3">
<h3 class="anchored" data-anchor-id="r-language">5.2.1 R Language</h3>
<p>Knowing R and R markdown: I needed to understand the concepts of different functions and many parameters in order to complete the replication project and produce a report.</p>
</section>
<section id="data-aquisition" class="level3">
<h3 class="anchored" data-anchor-id="data-aquisition">5.2.2 Data Aquisition</h3>
<p>Some challenges were observed during the acquiring of data. Acquiring <code>seer_data</code> dataset while trying to download this <code>seer_data</code> dataset by following instructions laid down in this project’s README file at the following link - <a href="https://seer.cancer.gov/popdata/download.html">https://seer.cancer.gov/popdata/download.html</a>. The limitation is that the download came as an executable file (.exe), which can’t be imported directly into RStudio for data analysis.</p>
<p>Since the.exe file could not be used within RStudio, my approach needed to change. Rather than try to extract data from the executable file a process that would have required using other tools and several steps outside of R, I used already available data from the replication package. The package provided several ‘.dta’ files that could hold segments of data different from what I would need for this analysis.</p>
<p>To proceed with that effectively, I imported these ‘.dta’ files into R to take a look at what was inside. This examination included reading the columns of each file to understand the types of data they contained and to determine which dataset was necessary for each specific figure I intended to reproduce. In general, this decision was taken to avoid complexity with the ‘.exe’ file in generating the analysis and rely on the already available ‘.dta’ files available within the replication package. This way, I am able to continue the analysis using reliable and accessible data formats suitable for RStudio.</p>
<p>This approach emphasizes flexibility in data management strategies, especially in terms of unexpected technical problems during data collection. I could maintain the integrity and progress of the analysis, given the circumstance and using whatever resources were available at that time.</p>
</section>
<section id="graphical-representations" class="level3">
<h3 class="anchored" data-anchor-id="graphical-representations">5.2.3 Graphical Representations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>birth_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"nchs_births_pop_1990_2019.dta"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>birth_data[<span class="fu">is.na</span>(birth_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total births per year</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>birth_yearly <span class="ot">&lt;-</span> birth_data <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_births =</span> <span class="fu">sum</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"numbirth_"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the trend in total births with a vertical line at 2007</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>fig_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(birth_yearly, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_births)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2007</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trend in Total Births (1990-2019)"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Births"</span>) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot as a PNG file</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(output_path, <span class="at">plot =</span> fig_1, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the graph</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fig_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="The-Puzzle-of-falling-birth-rates-in-US_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>One off the difficult problem I encountered in trying to reproduce the trend analysis of total births using the R script was that of the availability of data. The original graph presented in the paper ran from 1980 to 2022, thus giving an extensive view of the birth trends for over four decades. However, the replication package dataset, <code>nchs_births_pop_1990_2019.dta</code>, contains data only up to 2019. In this way, the first decade, from 1980 to 1989, and the last three years, from 2020 to 2022, were missing in the analysis.</p>
<p>This mismatch in the period range raised some difficulties in obtaining an exact replication of the original graph. These missing years reduced the temporal scope of the analysis, apart from possibly affecting the trends leading up to 1990 and after 2019, which could have included major demographic shifts or policy impacts on birth rates. Accordingly, although I was able to plot and analyze the data available within the period 1990 to 2019, the graph that I created was not able to capture either the historical breadth or the most recent trends that the original study portrayed.</p>
<p>Considering this to be a limiting problem, the presentation of the trends should be strictly focused on accurately mimicking what can be depicted based on data trends from 1990 to 2019. I key events and shifts, such as a dash vertical line set at 2007 in relation to marking certain events or breaks in birth tendencies. However, the inability to incorporate data from 1980-1989 and 2020-2022 was an important limitation in fully replicating the insights and implications of the original graph. This experience also reminded me of the need to have full access to complete data sets for doing historical analysis and flexibility in adapting the techniques of analysis to what the data allow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#load the data set </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"age_race_comp_seer.dta"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>pop_data_processed <span class="ot">&lt;-</span> pop_data <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop1544 =</span> pop1519 <span class="sc">+</span> pop2034 <span class="sc">+</span> pop3544,  <span class="co"># Summing population age groups</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stname =</span> <span class="fu">toupper</span>(<span class="fu">trimws</span>(stname))  <span class="co"># Normalize state names</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((year <span class="sc">&gt;=</span> <span class="dv">2004</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2008</span>) <span class="sc">|</span> (year <span class="sc">&gt;=</span> <span class="dv">2015</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2019</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year2 =</span> <span class="fu">ifelse</span>(year <span class="sc">&lt;=</span> <span class="dv">2008</span>, <span class="dv">2004</span>, <span class="dv">2019</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Collapse years</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stname, year2) <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop1544 =</span> <span class="fu">sum</span>(pop1544, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Process birth data</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">'numbirth1544'</span> <span class="sc">%in%</span> <span class="fu">names</span>(birth_data)) {</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"The column 'numbirth1544' does not exist in the birth data."</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>birth_data_processed <span class="ot">&lt;-</span> birth_data <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stname =</span> <span class="fu">toupper</span>(<span class="fu">trimws</span>(stname))) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((year <span class="sc">&gt;=</span> <span class="dv">2004</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2008</span>) <span class="sc">|</span> (year <span class="sc">&gt;=</span> <span class="dv">2015</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2019</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year2 =</span> <span class="fu">ifelse</span>(year <span class="sc">&lt;=</span> <span class="dv">2008</span>, <span class="dv">2004</span>, <span class="dv">2019</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Collapse years</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stname, year2) <span class="sc">%&gt;%</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">numbirth1544 =</span> <span class="fu">sum</span>(numbirth1544, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge birth &amp; population data</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(birth_data_processed, pop_data_processed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"stname"</span>, <span class="st">"year2"</span>))</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for merge issues</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(merged_data) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.na</span>(merged_data<span class="sc">$</span>pop1544))) {</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Merge failed or 'pop1544' data is missing."</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate1544_thsnds =</span> (numbirth1544 <span class="sc">/</span> pop1544) <span class="sc">*</span> <span class="dv">1000</span>  <span class="co"># Birth rate per 1,000 women aged 15-44</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> year2, <span class="at">values_from =</span> brate1544_thsnds, </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"brate_"</span>, </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">brate1544_thsnds =</span> <span class="cn">NA</span>)  <span class="co"># Fill missing values as NA</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate1544_thsnds_ch =</span> brate_2019 <span class="sc">-</span> brate_2004,  <span class="co"># Calculate birth rate change</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">brate1544_thsnds_ch_pct =</span> <span class="dv">100</span> <span class="sc">*</span> (brate_2019 <span class="sc">-</span> brate_2004) <span class="sc">/</span> brate_2004  <span class="co"># Percentage change</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare geographic data</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(tigris<span class="sc">::</span><span class="fu">states</span>(<span class="at">cb =</span> <span class="cn">TRUE</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Puerto Rico"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stname =</span> NAME)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge geographic data with birth rate changes</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>geo_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(states, merged_data, <span class="at">by =</span> <span class="st">"stname"</span>)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix missing rate_change values before plotting</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>geo_data<span class="sc">$</span>brate1544_thsnds_ch <span class="ot">&lt;-</span> <span class="fu">replace_na</span>(geo_data<span class="sc">$</span>brate1544_thsnds_ch, <span class="dv">0</span>)  <span class="co"># Avoid NA in plotting</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="co">#Define Bins and Colors for Population Decline**</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#d73027"</span>, <span class="st">"#fc8d59"</span>, <span class="st">"#fee08b"</span>, <span class="st">"#91bfdb"</span>)  <span class="co"># Red to blue color scheme</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="cn">Inf</span>)                      <span class="co"># Define bins for change</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"&lt; -10%"</span>, <span class="st">"-10% to -5%"</span>, <span class="st">"-5% to 0%"</span>, <span class="st">"&gt; 0%"</span>)  <span class="co"># Labels for bins</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>fig_3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(geo_data) <span class="sc">+</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">cut</span>(brate1544_thsnds_ch, <span class="at">breaks =</span> breaks, <span class="at">labels =</span> labels)), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, brate1544_thsnds_ch), <span class="at">geometry =</span> geometry),</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>,</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">100</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">setNames</span>(colors, labels), <span class="at">name =</span> <span class="st">"Birth Rate Change (%)"</span>) <span class="sc">+</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Decline in Birth Rates by State (2004-2008 to 2015-2019)"</span>,</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Birth rates per 1,000 women aged 15-44"</span>,</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data: NCHS Vital Statistics &amp; CDC SEER"</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="co">#Save High-Resolution Map</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(output_path, <span class="at">plot =</span> fig_3, <span class="at">width =</span> <span class="dv">14</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fig_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="The-Puzzle-of-falling-birth-rates-in-US_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this R script, while integrating and analyzing state-level birth and population data to examine trends in birth rates across different U.S. states, I encountered a significant issue related to missing values during the data merging process. This challenge arose from the merging of processed birth data and population data into a single dataset.</p>
<p>After processing the birth and population data separately, making sure each of the datasets included total births and population of women aged 15-44 for specific year groups (2004-2008 and 2015-2019), I merged these two sets. The merge was to combine births by numbers with the respective population by state and year group for easy computation of birth rates per 1,000 women. In reality, this was not the case in the actual merging.</p>
<p>The main complication arose with the discrepancies in the data, such as different state names or missing entries in one of the datasets, leading to a lot of NA values in the merged dataset. Specifically, the ‘pop1544’ column, which was supposed to contain the total female population aged 15-44, had missing values for some states or years. This was critical because the birth rate calculations required both the number of births and the population data to be present and correctly matched.</p>
<p>These missing values mean that when I compute changes in the birth rate across the two time periods, states with a missing population data get a default 0% change in birth rate. This heavily biased the analysis toward showing, in general, no change in birth rates across all states, which was not at all representative of the underlying data.</p>
</section>
</section>
<section id="future-scope" class="level2">
<h2 class="anchored" data-anchor-id="future-scope">5.3 Future Scope</h2>
<p>Moving forward, I would put in a lot of effort to handle the executable file with the refined and perhaps more detailed population data needed for an in-depth analysis. Firstly, I will make use of a software package or scripting to extract the dataset embedded in this executable file. This would be a very important process in that, through getting hold of the latest and most complete data, a trend analysis on birth rates could be done more comprehensively.</p>
<p>After extracting and verifying the data from the.exe file, I will integrate this new information into our existing datasets. Such integration will most likely involve the revision of our data processing routines to accommodate any new data formats or additional variables that come with the updated dataset.</p>
<p>With the newly integrated data, I will focus extensively on enhancing the data visualization components of the project. This will be based on the generation of more intelligent graphical representations for complex trends in an attempt at deeper insights towards factors affecting births across different demographic and regional trends. I might consider a range of visuals that are more interactive; given that this will let one interact more dynamically with visualizations through online interfaces or dashboard interactions. These will include, among other analysis tools, the ability for stakeholders to consider different scenarios and pull out tailored insights relevant to specific interests or areas of policy interest.</p>
<p>Besides, I intend to leverage some more advanced techniques, including predictive modeling and machine learning that may use historic data coupled with future socio-economic projected changes to estimate the trends of birth rates into the future. Predictive insight will thus be invaluable in planning by policymakers and healthcare providers for future needs.</p>
<p>Ultimately, this extension of the scope of the project will help in providing richer analysis with more comprehensive data, but also, more importantly, enhance access and usability through superior data visualization techniques. This would ensure that the findings of the project can actually inform decisions and policies that seek to address the dynamics of population growth and demographic changes.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>6 Conclusion</h1>
<p>The project, through the integration of highly detailed datasets and hi-tech methodologies, places current understanding of birth rate trends across the United States at a whole new level. While there were initial issues in acquiring data, for the most part-key visualizations, which were imperative in developing critical insight into the dynamics of U.S. birth rates, were able to be created through the use of alternative data from the replication package.</p>
<p><strong>Figure 1</strong>, “Trend in Total Births (1990-2019),” showed the long-term trends and fluctuations in national birth rates over almost three decades, despite missing data for earlier and more recent years. This visualization emphasized some of the major temporal shifts, such as the dramatic decline around the time of the 2007 economic downturn, in a clear historical context of how economic factors can influence birth rates.</p>
<p><strong>Figure 3</strong>, “Decline in Birth Rates by State (2004-2008 to 2015-2019),” further broke down the regional variation in birth rates for different states in two separate periods. This was very helpful in locating state-to-state differences and trends, hence showing how local policy, economic conditions, and demographic influences produced different impacts on the trend in birth rates across major parts of the country.</p>
<p><strong>Figure 5</strong>, “Lifetime Fertility, by Mother’s Birth Cohort: US,” puts this in a more longitudinal perspective to examine the change over time in fertility rates across different generations of women. Tracing cumulative births per woman in successive birth cohorts, generational changes in reproductive behavior became vividly apparent in this graph, and it illustrated how societal changes and policy reversals across several decades have played into family-size decisions.</p>
<p>Put together, they form a whole picture of influences that shape the birth rates of the United States. The different economic, regional, and generational shifts to reproductive choices serve to provide ample insights for thinkers into policy issues, health professionals, and social planners. Instructive not only in illustrating past and current trends but, indeed, predict future demographic shifts.</p>
<p>In the future, the project will be further improved by updating with more recent and complete data, enhancing the level of sophistication in data visualization, and expanding the predictive analytics. These steps will ensure that the project continues to provide valuable insights into birth rate trends, supporting informed decision-making that can adapt to changing societal needs. By deepening the analysis and broadening the scope, this project has the potential to contribute even more significantly to our understanding of demographic dynamics and inform effective public health strategies and policies.</p>
</section>
<section id="presentation-using-github" class="level1">
<h1>7 Presentation using Github</h1>
<p>GitHub is a good website for those who want to become programmers since it fosters collaboration and knowledge sharing. For further information on the exercise, please check out Professor Dr.&nbsp;Stephan Huber’s GitHub page: hubchev/ds_summer23</p>
<p>To control and display the project at once we have created a repository called “The_Puzzle_of_falling_birthrates_in_USA” in which you can upload standalone HTML files and other documents of interest. After making changes into the GitHub repo, after reviewing all updates, I used my official username in <a href="https://github.com/VenkateshKannan1999/The_Puzzle_of_falling_birthrates_in_USA.git">GitHubhttps://github.com/VenkateshKannan1999/The_Puzzle_of_falling_birthrates_in_USA.git</a>,the website is stored as an HTML format. The final step is pushing all relevant project files to this repository so that it is easily accessible.</p>
</section>
<section id="affidavit" class="level1">
<h1>8 Affidavit</h1>
<p>I hereby affirm that this submitted paper was authored unaided and solely by me. Additionally, no other sources than those in the reference list were used. Parts of this paper, including tables and figures, that have been taken either verbatim or analogously from other works have in each case been properly cited with regard to their origin and authorship. This paper either in parts or in its entirety, be it in the same or similar form, has not been submitted to any other examination board and has not been published.</p>
<p>I have read the Handbook of Academic Writing by Hildebrandt &amp; Nelke (2019) and have endeavored to comply with the guidelines and standards set forth therein.</p>
<p>I acknowledge that the university may use plagiarism detection software to check my thesis. I agree to cooperate with any investigation of suspected plagiarism and to provide any additional information or evidence requested by the university.</p>
<p>The report includes:</p>
<ul class="task-list">
<li><p><label><input type="checkbox" checked="">About 4000 words (+/- 500).</label></p></li>
<li><p><label><input type="checkbox" checked="">A title page with personal details (name, email, matriculation number).</label></p></li>
<li><p><label><input type="checkbox" checked="">An abstract.</label></p></li>
<li><p><label><input type="checkbox" checked="">A bibliography, created using BibTeX with APA citation style.</label></p></li>
<li><p><label><input type="checkbox" checked="">The complete R code required to reproduce the results.</label></p></li>
<li><p><label><input type="checkbox" checked="">Detailed instructions on data acquisition and importation into</label></p>
<ol start="18" type="A">
<li></li>
</ol></li>
<li><p><label><input type="checkbox" checked="">An introduction to guide the reader and a conclusion summarizing the work and discussing potential future extensions.</label></p></li>
<li><p><label><input type="checkbox" checked="">All significant resources used in the report and R code development.</label></p></li>
<li><p><label><input type="checkbox" checked="">The filled out Affidavit.</label></p></li>
<li><p><label><input type="checkbox">A concise description of the successful use of Git and GitHub, as detailed here: - - make_a_pull_request.</label></p></li>
<li><p><label><input type="checkbox" checked="">A concise description of the presentation published on GitHub.</label></p></li>
<li><p><label><input type="checkbox" checked="">The project submission includes:</label></p></li>
<li><p><label><input type="checkbox" checked="">… The .qmd file(s) of the report.</label></p></li>
<li><p><label><input type="checkbox">… The quarto.yml file of the report.</label></p></li>
<li><p><label><input type="checkbox" checked="">… The .pdf file of the report.</label></p></li>
<li><p><label><input type="checkbox" checked="">… The standalone .html file of the report.</label></p></li>
<li><p><label><input type="checkbox" checked="">… All necessary files (not available online) to reproduce the report and the R code.</label></p></li>
<li><p><label><input type="checkbox" checked="">… The standalone .html file of the presentation.</label></p></li>
</ul>
<p><span class="math display">\[Venkatesh Kannan\]</span> <span class="math display">\[02,02,2025\]</span> <span class="math display">\[Cologne,Germany\]</span> ## References</p>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-10.1257/jep.36.1.151" class="csl-entry" role="listitem">
Kearney, M. S., Levine, P. B., &amp; Pardue, L. (2022). The puzzle of falling US birth rates since the great recession. <em>Journal of Economic Perspectives</em>, <em>36</em>(1), 151–176. <a href="https://doi.org/10.1257/jep.36.1.151">https://doi.org/10.1257/jep.36.1.151</a>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>